# Java并发编程

## 一.Synchronized

​	Synchronized是java中实现同步的一种机制，是用来保证内存可见性和操作原子性的，它的实现基础是java中的任何一个对象都可以当做锁。

​	Synchronized的使用形式有三种：

- 实现在普通同步方法，锁对象是当前实例对象；

- 实现在静态同方法，锁对象是对象的类对象，对此类的所有实例对象都生效；

- 实现在同步代码块，锁对象是小括号里面的对象。

​	Synchronized在JVM中的实现原理是基于进入和退出Monitor对象来实现的，代码块同步是通过monitorenter指令和monitorexit指令来实现的，方法同步也可以这样实现。在代码编译后monitorenter指令会插入到同步代码块的开始位置，monitorexit指令会在代码块结束和异常位置插入。

​	根据JVM规范，在执行monitorenter指令的时候，首先需要去尝试获取对象的锁，如果这个对象没有被锁定，或者被本线程获取到，那就在这个锁的计数器上加1，然后在执行，当再次遇到monitorenter时，再在计数器加1，这就是可重入性，当执行到monitorexit时，计数器减1；另一个线程在获取此对象锁时，如果计数器不为0则代表此对象已经被锁定，该线程进入阻塞状态，等待其它线程释放锁然后再获取再继续执行，中间不能干其它事。

​	Synchronized用的锁是存在Java对象头里的。

（待深入研究。。。）

二.CAS

