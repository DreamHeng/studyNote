# HashMap

## 面试

##### 1.核心数据结构

​	HashMap底层是最核心的数据结构是数组，取key的hash值，然后对数组长度取模，结果即为在数组中的索引，该索引中有值即为hash冲突。

##### 2.hash值的优化

​	HashMap底层对取key的hash值进行了优化：
- key为null，则hash值为0；
- key不为null，取key的hashCode()为h(int类型,32位)，在和h右移16位(即前16位全置为0,后16位置为原前16位)做异或运算(^)[^1]；这样做的目的是为了使hash值充分均匀，且可以有效减少hash值有效位数，为寻址运算减少运算量。

​	HashMap底层取hash的优化源码如下（JDK1.8）：


```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

##### 3.寻址优化

​	HashMap底层在key的hash值对数字长度进行取模得索引进行了改造，现在的寻址操作并不是对key取模找索引，而是用**与运算(&)[^2]等代替取模运算**，提高运算性能，这是因为在计算机的运算中`与运算`效率远高于`取模运算`。且在数组长度为2的n次方情况下进行的`与运算`结果等同于`取模运算`。

与运算公式（其中的hash为优化过的hash值，n为数字长度）：

```
(n - 1) & hash
```

















[^1]: 异或运算(^)，计算机二进制运算的一种，相同为0，不同为1，如0^1为1，1^1为0.
[^2]:与运算(&)，计算机二进制运算的一种，两个都是1为1，其它都为0，如1&1为1，1&0为0，0&0为0.